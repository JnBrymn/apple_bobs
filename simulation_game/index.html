<!-- 
BUILDING A COMMUNITY - A fun world where you can:
- Build houses, farms, and other buildings
- Manage resources (money, food, energy)
- Watch people walk around, kids go to school, and people visit stores!
- More people = stores make money faster, but food goes down faster
-->
<!DOCTYPE html>
<html>
<head>
	<title>ğŸŒ Building a Community ğŸŒ</title>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
		
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		body {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			font-family: 'Comic Neue', cursive;
			color: #fff;
			overflow: hidden;
			height: 100vh;
		}
		
		#header {
			background: rgba(0, 0, 0, 0.7);
			padding: 15px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-bottom: 3px solid #ffd700;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
		}
		
		#title {
			font-size: 2em;
			font-weight: bold;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
		}
		
		#stats {
			display: flex;
			gap: 20px;
			font-size: 1.1em;
		}
		
		.stat {
			background: rgba(255, 255, 255, 0.2);
			padding: 8px 15px;
			border-radius: 10px;
			border: 2px solid #ffd700;
		}
		
		.stat-value {
			color: #ffd700;
			font-weight: bold;
		}
		
		#gameContainer {
			display: flex;
			height: calc(100vh - 80px);
		}
		
		#sidebar {
			width: 250px;
			background: rgba(0, 0, 0, 0.8);
			padding: 20px;
			overflow-y: auto;
			border-right: 3px solid #ffd700;
		}
		
		.section-title {
			font-size: 1.3em;
			margin: 20px 0 10px 0;
			color: #ffd700;
			text-align: center;
			border-bottom: 2px solid #ffd700;
			padding-bottom: 5px;
		}
		
		.item-btn {
			background: rgba(255, 255, 255, 0.1);
			border: 2px solid #fff;
			color: #fff;
			padding: 12px;
			margin: 8px 0;
			border-radius: 10px;
			cursor: pointer;
			font-size: 1.1em;
			transition: all 0.3s;
			text-align: center;
		}
		
		.item-btn:hover {
			background: rgba(255, 215, 0, 0.3);
			transform: scale(1.05);
			border-color: #ffd700;
		}
		
		.item-btn:active {
			transform: scale(0.95);
		}
		
		.item-btn.selected {
			background: rgba(255, 215, 0, 0.5);
			border-color: #ffd700;
			box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
		}
		
		.item-btn.disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}
		
		#gameCanvas {
			flex: 1;
			background: #2d5016;
			cursor: crosshair;
		}
		
		#info {
			position: absolute;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(0, 0, 0, 0.8);
			padding: 15px 30px;
			border-radius: 15px;
			border: 2px solid #ffd700;
			font-size: 1.1em;
			text-align: center;
		}
	</style>
</head>
<body>
	<div id="header">
		<h1 id="title">ğŸŒ <span id="communityName" onclick="editCommunityName()" style="cursor: pointer; text-decoration: underline;" title="Click to rename">Building a Community</span> ğŸŒ</h1>
		<div id="stats">
			<div class="stat">ğŸ’° Money: <span class="stat-value" id="money">1000</span></div>
			<div class="stat">ğŸ Food: <span class="stat-value" id="food">100</span></div>
			<div class="stat">âš¡ Energy: <span class="stat-value" id="energy">100</span></div>
			<div class="stat">ğŸ‘¥ Population: <span class="stat-value" id="population">0</span></div>
		</div>
	</div>
	
	<div id="gameContainer">
		<div id="sidebar">
			<div class="section-title">ğŸ—ï¸ Buildings</div>
			<div class="item-btn" onclick="selectItem('house')">ğŸ  House (Cost: 200)</div>
			<div class="item-btn" onclick="selectItem('farm')">ğŸŒ¾ Farm (Cost: 300)</div>
			<div class="item-btn" onclick="selectItem('factory')">ğŸ­ Factory (Cost: 500)</div>
			<div class="item-btn" onclick="selectItem('shop')">ğŸª Shop (Cost: 400, Uses: 3 food/sec, Money based on population)</div>
			<div class="item-btn" onclick="selectItem('school')">ğŸ“ School (Cost: 350)</div>
			
			<div class="section-title">âš¡ Actions</div>
			<div class="item-btn" onclick="clearSelection()">âŒ Clear Selection</div>
			<div class="item-btn" onclick="deleteAll()">ğŸ—‘ï¸ Delete Everything</div>
		</div>
		
		<canvas id="gameCanvas"></canvas>
	</div>
	
	<div id="info">Click on the world to place items! ğŸ®</div>
	
	<!-- Name input dialog -->
	<div id="nameDialog" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 1000;">
		<div style="background: rgba(0, 0, 0, 0.9); padding: 30px; border-radius: 15px; border: 3px solid #ffd700; text-align: center;">
			<h2 style="color: #ffd700; margin-bottom: 20px; font-size: 1.5em;">Name Your Community!</h2>
			<p style="color: #fff; font-size: 0.9em; margin-bottom: 10px;">Must have at least one space and end with "Community"</p>
			<input type="text" id="communityNameInput" placeholder="Example: My Community" style="padding: 15px; font-size: 1.2em; border: 2px solid #ffd700; border-radius: 10px; background: rgba(255, 255, 255, 0.1); color: #fff; width: 300px; text-align: center;" maxlength="30">
			<br><br>
			<button onclick="setCommunityName()" style="padding: 12px 30px; font-size: 1.1em; background: #ffd700; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; color: #000;">Start Building!</button>
		</div>
	</div>
	
	<script>
		// Game state
		const gameState = {
			money: 1000,
			food: 100,
			energy: 100,
			population: 0,
			selectedItem: null,
			items: [],
			people: [],
			communityName: 'Building a Community'
		};
		
		// Item definitions
		const itemTypes = {
			// Buildings
			house: { emoji: 'ğŸ ', name: 'House', cost: 200, type: 'building', produces: { population: 5, money: 1 } },
			farm: { emoji: 'ğŸŒ¾', name: 'Farm', cost: 300, type: 'building', produces: { food: 5, money: 2 } },
			factory: { emoji: 'ğŸ­', name: 'Factory', cost: 500, type: 'building', produces: { money: 10, energy: -2 } },
			shop: { emoji: 'ğŸª', name: 'Shop', cost: 400, type: 'building', produces: { money: 0, population: 1 }, consumes: { food: 3 } },
			school: { emoji: 'ğŸ“', name: 'School', cost: 350, type: 'building', produces: { population: 2, happiness: 1 } }
		};
		
		// Canvas setup
		const canvas = document.getElementById('gameCanvas');
		const ctx = canvas.getContext('2d');
		let grassPattern = null;
		
		function generateGrassPattern() {
			// Create a pattern that we'll reuse
			const patternCanvas = document.createElement('canvas');
			patternCanvas.width = canvas.width;
			patternCanvas.height = canvas.height;
			const patternCtx = patternCanvas.getContext('2d');
			
			// Fill background
			patternCtx.fillStyle = '#2d5016';
			patternCtx.fillRect(0, 0, patternCanvas.width, patternCanvas.height);
			
			// Draw grass dots once
			patternCtx.fillStyle = '#3a6b1f';
			for (let i = 0; i < patternCanvas.width; i += 40) {
				for (let j = 0; j < patternCanvas.height; j += 40) {
					if (Math.random() > 0.7) {
						patternCtx.fillRect(i, j, 2, 2);
					}
				}
			}
			
			grassPattern = patternCanvas;
		}
		
		function resizeCanvas() {
			canvas.width = canvas.offsetWidth;
			canvas.height = canvas.offsetHeight;
			generateGrassPattern();
		}
		
		resizeCanvas();
		window.addEventListener('resize', resizeCanvas);
		
		// Person class
		class Person {
			constructor(x, y, type = 'adult') {
				this.x = x;
				this.y = y;
				this.type = type; // 'adult' or 'kid'
				this.targetX = null;
				this.targetY = null;
				this.targetBuilding = null;
				this.speed = 1;
				this.state = 'wandering'; // 'wandering', 'goingToBuilding', 'atBuilding'
				this.homeX = x;
				this.homeY = y;
				this.timeAtBuilding = 0;
				this.shouldRemove = false; // Mark for removal when reaching building
				this.emoji = type === 'kid' ? 'ğŸ§’' : 'ğŸ§‘';
			}
			
			update() {
				// Find a target building
				if (this.state === 'wandering' && Math.random() < 0.01) {
					if (this.type === 'kid') {
						// Kids go to schools
						const schools = gameState.items.filter(item => item.type === 'school');
						if (schools.length > 0) {
							const school = schools[Math.floor(Math.random() * schools.length)];
							this.targetX = school.x;
							this.targetY = school.y;
							this.targetBuilding = school;
							this.state = 'goingToBuilding';
						}
					} else {
						// Adults go to stores and farms
						const stores = gameState.items.filter(item => item.type === 'shop');
						const farms = gameState.items.filter(item => item.type === 'farm');
						const allBuildings = [...stores, ...farms];
						
						if (allBuildings.length > 0) {
							const building = allBuildings[Math.floor(Math.random() * allBuildings.length)];
							this.targetX = building.x;
							this.targetY = building.y;
							this.targetBuilding = building;
							this.state = 'goingToBuilding';
						}
					}
				}
				
				// Move towards target
				if (this.state === 'goingToBuilding' && this.targetX !== null) {
					const dx = this.targetX - this.x;
					const dy = this.targetY - this.y;
					const distance = Math.sqrt(dx * dx + dy * dy);
					
					if (distance < 5) {
						// Reached building - disappear!
						this.shouldRemove = true;
					} else {
						this.x += (dx / distance) * this.speed;
						this.y += (dy / distance) * this.speed;
					}
				}
				
				// Random wandering
				if (this.state === 'wandering') {
					if (Math.random() < 0.02) {
						this.targetX = this.homeX + (Math.random() - 0.5) * 200;
						this.targetY = this.homeY + (Math.random() - 0.5) * 200;
					}
					
					if (this.targetX !== null) {
						const dx = this.targetX - this.x;
						const dy = this.targetY - this.y;
						const distance = Math.sqrt(dx * dx + dy * dy);
						
						if (distance < 5) {
							this.targetX = null;
							this.targetY = null;
						} else {
							this.x += (dx / distance) * this.speed;
							this.y += (dy / distance) * this.speed;
						}
					}
				}
			}
			
			draw() {
				ctx.save();
				ctx.font = '20px Arial';
				ctx.textAlign = 'center';
				ctx.textBaseline = 'middle';
				ctx.fillText(this.emoji, this.x, this.y);
				ctx.restore();
			}
		}
		
		// Item class
		class GameItem {
			constructor(x, y, type) {
				this.x = x;
				this.y = y;
				this.type = type;
				this.data = itemTypes[type];
				this.age = 0;
				// For houses: track gradual people spawning
				if (type === 'house') {
					this.nextSpawnTime = 0;
				}
			}
			
			update() {
				this.age++;
				
				// Continuously spawn people from houses (spaced out)
				if (this.type === 'house') {
					if (this.age >= this.nextSpawnTime) {
						// Spawn one person (mostly adults, sometimes kids)
						const isKid = Math.random() < 0.2; // 20% chance of kid
						const person = new Person(
							this.x + (Math.random() - 0.5) * 40,
							this.y + (Math.random() - 0.5) * 40,
							isKid ? 'kid' : 'adult'
						);
						person.homeX = this.x;
						person.homeY = this.y;
						gameState.people.push(person);
						// Schedule next spawn in 5-10 seconds (300-600 frames) - spaced out
						this.nextSpawnTime = this.age + 300 + Math.random() * 300;
					}
				}
				
				// Apply production and consumption
				if (this.age % 60 === 0) { // Every second (60 frames)
					// First, check if we can consume resources
					let canConsume = true;
					if (this.data.consumes) {
						Object.keys(this.data.consumes).forEach(resource => {
							const amount = this.data.consumes[resource];
							if (resource === 'food' && gameState.food < amount) canConsume = false;
							if (resource === 'energy' && gameState.energy < amount) canConsume = false;
							if (resource === 'money' && gameState.money < amount) canConsume = false;
						});
					}
					
					// If we can consume, do production and consumption
					if (canConsume) {
						// Consume resources first
						if (this.data.consumes) {
							Object.keys(this.data.consumes).forEach(resource => {
								const amount = this.data.consumes[resource];
								if (resource === 'food') gameState.food -= amount;
								if (resource === 'energy') gameState.energy -= amount;
								if (resource === 'money') gameState.money -= amount;
							});
						}
						
						// Then produce resources
						Object.keys(this.data.produces).forEach(resource => {
							let amount = this.data.produces[resource];
							
							// Shops make money based on population
							if (this.type === 'shop' && resource === 'money') {
								// Base money + population bonus (more people = more money)
								amount = 2 + Math.floor(gameState.population / 10);
							}
							
							if (resource === 'money') gameState.money += amount;
							if (resource === 'food') gameState.food += amount;
							if (resource === 'energy') gameState.energy += amount;
							if (resource === 'population') gameState.population += amount;
							if (resource === 'happiness') {
								// Happiness affects other stats
								gameState.money += amount * 0.5;
							}
						});
					}
				}
			}
			
			draw() {
				ctx.save();
				ctx.font = '32px Arial';
				ctx.textAlign = 'center';
				ctx.textBaseline = 'middle';
				
				// Item
				ctx.fillText(this.data.emoji, this.x, this.y);
				
				ctx.restore();
			}
		}
		
		// Game functions
		function selectItem(type) {
			if (gameState.money >= itemTypes[type].cost) {
				gameState.selectedItem = type;
				
				// Update button styles
				document.querySelectorAll('.item-btn').forEach(btn => {
					btn.classList.remove('selected');
				});
				event.target.classList.add('selected');
				
				updateInfo(`Selected ${itemTypes[type].name}. Click to place!`);
			} else {
				updateInfo(`Not enough money! Need ${itemTypes[type].cost} ğŸ’°`);
			}
		}
		
		function clearSelection() {
			gameState.selectedItem = null;
			document.querySelectorAll('.item-btn').forEach(btn => {
				btn.classList.remove('selected');
			});
			updateInfo('Selection cleared!');
		}
		
		function deleteAll() {
			if (confirm('Delete everything? This cannot be undone!')) {
				gameState.items = [];
				gameState.people = [];
				gameState.population = 0;
				updateInfo('Everything deleted!');
			}
		}
		
		function placeItem(x, y) {
			if (gameState.selectedItem) {
				const itemType = gameState.selectedItem;
				const cost = itemTypes[itemType].cost;
				
				if (gameState.money >= cost) {
					const newItem = new GameItem(x, y, itemType);
					gameState.items.push(newItem);
					gameState.money -= cost;
					
					if (itemTypes[itemType].type === 'building') {
						const popIncrease = itemTypes[itemType].produces.population || 0;
						gameState.population += popIncrease;
						
						// Houses will gradually spawn people (handled in GameItem.update)
					}
					
					updateInfo(`Placed ${itemTypes[itemType].name}!`);
					gameState.selectedItem = null;
					document.querySelectorAll('.item-btn').forEach(btn => {
						btn.classList.remove('selected');
					});
				} else {
					updateInfo(`Not enough money! Need ${cost} ğŸ’°`);
				}
			}
		}
		
		function updateInfo(message) {
			const info = document.getElementById('info');
			info.textContent = message;
			setTimeout(() => {
				info.textContent = 'Click on the world to place items! ğŸ®';
			}, 3000);
		}
		
		function updateDisplay() {
			document.getElementById('money').textContent = Math.floor(gameState.money);
			document.getElementById('food').textContent = Math.floor(gameState.food);
			document.getElementById('energy').textContent = Math.floor(gameState.energy);
			document.getElementById('population').textContent = Math.floor(gameState.population);
			
			// Update button states
			document.querySelectorAll('.item-btn').forEach(btn => {
				const text = btn.textContent;
				const match = text.match(/Cost: (\d+)/);
				if (match) {
					const cost = parseInt(match[1]);
					if (gameState.money < cost && !btn.classList.contains('selected')) {
						btn.classList.add('disabled');
					} else {
						btn.classList.remove('disabled');
					}
				}
			});
		}
		
		function draw() {
			// Draw the static grass pattern
			if (grassPattern) {
				ctx.drawImage(grassPattern, 0, 0);
			} else {
				// Fallback if pattern not ready
				ctx.fillStyle = '#2d5016';
				ctx.fillRect(0, 0, canvas.width, canvas.height);
			}
			
			// Draw items
			gameState.items.forEach(item => item.draw());
			
			// Draw people
			gameState.people.forEach(person => person.draw());
			
			// Draw preview
			if (gameState.selectedItem) {
				ctx.save();
				ctx.globalAlpha = 0.5;
				ctx.font = '32px Arial';
				ctx.textAlign = 'center';
				ctx.textBaseline = 'middle';
				ctx.fillText(itemTypes[gameState.selectedItem].emoji, mouseX, mouseY);
				ctx.restore();
			}
		}
		
		function update() {
			// Update items
			gameState.items.forEach(item => item.update());
			
			// Update people
			gameState.people.forEach(person => person.update());
			
			// Remove people who reached buildings
			gameState.people = gameState.people.filter(person => !person.shouldRemove);
			
			// Food consumption based on population (more people = less food)
			if (gameState.age % 60 === 0) { // Every second
				const foodConsumption = Math.floor(gameState.population / 5); // 1 food per 5 people per second
				gameState.food = Math.max(0, gameState.food - foodConsumption);
			}
			gameState.age = (gameState.age || 0) + 1;
			
			// Keep resources in bounds
			gameState.money = Math.max(0, gameState.money);
			gameState.food = Math.max(0, gameState.food);
			gameState.energy = Math.max(0, gameState.energy);
			gameState.population = Math.max(0, gameState.population);
		}
		
		function gameLoop() {
			update();
			draw();
			updateDisplay();
			requestAnimationFrame(gameLoop);
		}
		
		// Mouse tracking
		let mouseX = 0, mouseY = 0;
		canvas.addEventListener('mousemove', (e) => {
			const rect = canvas.getBoundingClientRect();
			mouseX = e.clientX - rect.left;
			mouseY = e.clientY - rect.top;
		});
		
		// Click to place
		canvas.addEventListener('click', (e) => {
			const rect = canvas.getBoundingClientRect();
			const x = e.clientX - rect.left;
			const y = e.clientY - rect.top;
			placeItem(x, y);
		});
		
		// Community name functions
		function setCommunityName() {
			const input = document.getElementById('communityNameInput');
			let name = input.value.trim() || 'My Community';
			
			// Check if name has at least one space
			if (!name.includes(' ')) {
				// If no space, add one before "Community"
				if (name.toLowerCase().endsWith('community')) {
					// Remove "community" if it's there, add space and "Community"
					name = name.replace(/\s*community\s*$/i, '').trim();
					if (name) {
						name = name + ' Community';
					} else {
						name = 'My Community';
					}
				} else {
					// Just add " Community" at the end
					name = name + ' Community';
				}
			} else {
				// Has space, check if ends with "community"
				const words = name.split(' ');
				const lastWord = words[words.length - 1].toLowerCase();
				if (lastWord !== 'community') {
					// Replace last word with "Community"
					words[words.length - 1] = 'Community';
					name = words.join(' ');
				} else {
					// Make sure "Community" is capitalized
					words[words.length - 1] = 'Community';
					name = words.join(' ');
				}
			}
			
			gameState.communityName = name;
			document.getElementById('communityName').textContent = name;
			document.getElementById('nameDialog').style.display = 'none';
		}
		
		function editCommunityName() {
			const dialog = document.getElementById('nameDialog');
			const input = document.getElementById('communityNameInput');
			input.value = gameState.communityName;
			dialog.style.display = 'flex';
			input.focus();
			input.select();
		}
		
		// Allow Enter key to submit name
		document.addEventListener('DOMContentLoaded', () => {
			const nameInput = document.getElementById('communityNameInput');
			if (nameInput) {
				nameInput.addEventListener('keypress', (e) => {
					if (e.key === 'Enter') {
						setCommunityName();
					}
				});
				// Show dialog on page load
				setTimeout(() => {
					nameInput.focus();
				}, 100);
			}
		});
		
		// Start game
		gameLoop();
		console.log('ğŸŒ Building a Community loaded! Have fun!');
	</script>
</body>
</html>

