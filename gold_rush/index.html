<!-- 
THE BACKWARD MAZE ESCAPE!
Story: You are a robber trying to escape a maze.
Goal: Reach the exit of the maze without getting caught by the smart police officer.
Mechanic: The police officer knows the shortest way to get you! The emojis are backward.
-->
<!DOCTYPE html>
<html>
<head>
    <title>The Backward Maze Escape!</title>
    <style>
        body {
            margin: 0;
            background: #2c3e50;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            color: #fff;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        #gameInfo {
            font-size: 24px;
            margin-bottom: 10px;
        }

        #mazeContainer {
            position: relative;
            display: grid;
            border: 5px solid #ecf0f1;
            background: #34495e;
        }

        .cell {
            width: 40px;
            height: 40px;
        }

        .wall {
            background-color: #2c3e50;
        }

        .path {
            background-color: #34495e;
        }
        
        .exit {
            background-color: #f1c40f; /* Gold for the exit */
        }

        .character {
            position: absolute;
            width: 40px;
            height: 40px;
            font-size: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s linear;
            /* The magic to make emojis backward! */
            transform: scaleX(-1);
        }
        
        .playerDebug {
            position: absolute;
            top: -10px;
            left: 5px;
            font-size: 20px;
            color: white;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s;
            /* Make the number face the right way */
            transform: scaleX(-1);
            text-shadow: 2px 2px 4px black;
        }

        #modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            z-index: 10;
            color: #f1c40f;
        }

        .button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }

        .button:hover {
            background: #2ecc71;
        }

    </style>
</head>
<body>
    <div id="gameInfo">
        <div>Level: <span id="level">1</span></div>
    </div>
    
    <div id="mazeContainer">
        <!-- The maze and characters will be generated by JavaScript -->
        <div id="modal">
            <div>The Backward Maze Escape!</div>
            <button class="button" onclick="restartGame()">Start Game</button>
        </div>
    </div>

    <div id="debugInfo" style="position: fixed; bottom: 10px; left: 10px; background: white; color: black; padding: 10px; border-radius: 5px; font-size: 16px; z-index: 100;"></div>

    <script>
        // Game Elements
        const mazeContainer = document.getElementById('mazeContainer');
        const levelDisplay = document.getElementById('level');
        const modal = document.getElementById('modal');
        const debugInfo = document.getElementById('debugInfo');

        // Game Settings
        const cellSize = 40;
        let currentLevel;
        let gameRunning = false;

        // Maze Layouts (0=path, 1=wall). The exit is now a separate object.
        const mazes = [
            [ // Level 1
                [1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,0,1],
                [1,0,1,0,1,0,1,1,0,1],
                [1,0,1,0,0,0,0,1,0,0], // Exit was here
                [1,0,1,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 2
                [1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,1,0,0,0,1,0,0,0,1],
                [1,0,1,1,0,1,0,1,1,1,0,1],
                [1,0,0,0,0,1,0,0,0,1,0,1],
                [1,1,1,1,0,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,1,0,0,0,0],
                [1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 3
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,1,0,0,0,0,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,1,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,0,0,1,0,1],
                [1,0,1,0,1,0,1,0,1,1,1,0,1,0,1],
                [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 4
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,1],
                [1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1],
                [1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1],
                [1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,0,1],
                [1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1],
                [1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1],
                [1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 5
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,1],
                [1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1],
                [1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0],
                [1,1,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1],
                [1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1],
                [1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 6
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,1],
                [1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,1,1,1,0,1],
                [1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,1,0,1],
                [1,0,1,1,1,0,1,1,1,1,1,0,1,0,1,0,1,0,1,1,0,1],
                [1,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,0,0,0,1],
                [1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,1,0,1],
                [1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,1],
                [1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,1],
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 7
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1],
                [1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1],
                [1,0,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1],
                [1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1],
                [1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1],
                [1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1],
                [1,0,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1],
                [1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 8
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,1],
                [1,0,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1],
                [1,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1],
                [1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,0,1,1,0,1],
                [1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1],
                [1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,0,1],
                [1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1],
                [1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,1,0,1],
                [1,0,0,0,1,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 9
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1],
                [1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0],
                [1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1],
                [1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1],
                [1,0,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1],
                [1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,1,0,1],
                [1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1],
                [1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,1],
                [1,0,1,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1],
                [1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1],
                [1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            [ // Level 10
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1], // Exit was here
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                [1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1],
                [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ]
        ];

        // NEW: Separate locations for the magic portals!
        const portalLocations = [
            { x: 9, y: 3 },  // Lvl 1
            { x: 10, y: 5 }, // Lvl 2
            { x: 1, y: 7 },  // Lvl 3
            { x: 15, y: 7 }, // Lvl 4
            { x: 18, y: 5 }, // Lvl 5
            { x: 20, y: 9 }, // Lvl 6
            { x: 23, y: 9 }, // Lvl 7
            { x: 1, y: 13 }, // Lvl 8
            { x: 28, y: 5 }, // Lvl 9
            { x: 32, y: 1 }  // Lvl 10
        ];

        let maze, player, police, portal;
        let policeInterval;

        function setupLevel(level) {
            maze = mazes[level - 1];
            if (!maze) {
                console.log("Error: Maze for level", level, "not found!");
                return;
            }
            mazeContainer.innerHTML = ''; // Clear old maze
            mazeContainer.style.gridTemplateColumns = `repeat(${maze[0].length}, ${cellSize}px)`;
            
            maze.forEach((row, y) => {
                row.forEach((cellType, x) => {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    if (cellType === 1) cell.classList.add('wall');
                    else if (cellType === 2) cell.classList.add('exit');
                    else cell.classList.add('path');
                    mazeContainer.appendChild(cell);
                });
            });

            // Create the magic portal (exit)
            const portalCoords = portalLocations[level - 1];
            portal = {
                x: portalCoords.x,
                y: portalCoords.y,
                element: document.createElement('div')
            };
            portal.element.classList.add('cell', 'exit');
            portal.element.style.position = 'absolute';
            portal.element.style.left = `${portal.x * cellSize}px`;
            portal.element.style.top = `${portal.y * cellSize}px`;
            mazeContainer.appendChild(portal.element);

            // Player and Police Setup
            player = { x: 1, y: 1, element: createCharacter('üèÉ', 'player') };
            police = { x: maze[0].length - 2, y: maze.length - 2, element: createCharacter('üöì', 'police') };
            
            mazeContainer.appendChild(player.element);
            mazeContainer.appendChild(police.element);
            
            drawCharacters();
            updateDebugInfo();
        }

        function createCharacter(emoji, id) {
            const el = document.createElement('div');
            el.classList.add('character');
            el.id = id;
            // Add the spy-watch display to the character
            el.innerHTML = `${emoji}<span id="${id}Debug" class="playerDebug"></span>`;
            return el;
        }
        
        function drawCharacters() {
            player.element.style.left = `${player.x * cellSize}px`;
            player.element.style.top = `${player.y * cellSize}px`;
            police.element.style.left = `${police.x * cellSize}px`;
            police.element.style.top = `${police.y * cellSize}px`;
        }
        
        function movePlayer(dx, dy) {
            if (!gameRunning) return;
            const newX = player.x + dx;
            const newY = player.y + dy;

            if (maze[newY] && maze[newY][newX] !== 1) { // Not a wall
                player.x = newX;
                player.y = newY;
                drawCharacters();

                // NEW MAGIC PORTAL CHECK!
                if (player.x === portal.x && player.y === portal.y) {
                    levelUp();
                } else if (player.x === police.x && player.y === police.y) {
                    endGame("You ran into the police!");
                }
            }
        }
        
        function movePolice() {
            // The magic smart police AI using Breadth-First Search (BFS)
            const path = findShortestPath({x: police.x, y: police.y}, {x: player.x, y: player.y});

            if (path && path.length > 1) {
                police.x = path[1].x;
                police.y = path[1].y;
                drawCharacters();
                
                if (player.x === police.x && player.y === police.y) {
                    endGame("The police caught you!");
                }
            }
        }

        function updateDebugInfo() {
            if (!player || !maze) return;
            const cellType = maze[player.y][player.x];
            debugInfo.textContent = `PLAYER X: ${player.x}, Y: ${player.y} | ON CELL TYPE: ${cellType}`;
        }

        function findShortestPath(start, end) {
            const queue = [[start]];
            const visited = new Set([`${start.y},${start.x}`]);

            while (queue.length > 0) {
                const path = queue.shift();
                const { x, y } = path[path.length - 1];

                if (x === end.x && y === end.y) {
                    return path;
                }

                // Check neighbors (up, down, left, right)
                const neighbors = [[0, 1], [0, -1], [1, 0], [-1, 0]];
                for (const [dx, dy] of neighbors) {
                    const newX = x + dx;
                    const newY = y + dy;
                    
                    if (maze[newY] && maze[newY][newX] !== 1 && !visited.has(`${newY},${newX}`)) {
                        visited.add(`${newY},${newX}`);
                        const newPath = [...path, {x: newX, y: newY}];
                        queue.push(newPath);
                    }
                }
            }
            return null; // No path found
        }
        
        function startGame(level) {
            currentLevel = level;
            levelDisplay.textContent = currentLevel;
            modal.style.display = 'none';
            gameRunning = true;
            setupLevel(currentLevel);
            // Police moves a bit slower at the start, but gets much faster!
            const policeSpeed = 850 - (currentLevel * 70);
            policeInterval = setInterval(movePolice, Math.max(100, policeSpeed));
        }

        function levelUp() {
            gameRunning = false;
            clearInterval(policeInterval);
            const nextLevelNum = currentLevel + 1;

            if (nextLevelNum > mazes.length) {
                modal.innerHTML = `<div>üèÜ YOU ESCAPED! üèÜ</div><button class="button" onclick="restartGame()">Play Again</button>`;
            } else {
                 modal.innerHTML = `<div>üëç GOOD JOB! üëç</div><button class="button" onclick="startGame(${nextLevelNum})">Continue</button>`;
            }
            modal.style.display = 'flex';
        }

        function endGame(message) {
            gameRunning = false;
            clearInterval(policeInterval);
            modal.innerHTML = `<div>üò¢ ${message} üò¢</div><button class="button" onclick="restartGame()">Try Again</button>`;
            modal.style.display = 'flex';
        }

        function restartGame() {
            modal.innerHTML = `<div>The Backward Maze Escape!</div><button class="button" onclick="startGame(1)">Start Game</button>`;
            modal.style.display = 'flex';
        }

        // Input Handling
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            if (e.key === 'ArrowUp') movePlayer(0, -1);
            else if (e.key === 'ArrowDown') movePlayer(0, 1);
            else if (e.key === 'ArrowLeft') movePlayer(-1, 0);
            else if (e.key === 'ArrowRight') movePlayer(1, 0);
        });

        // Make the modal show up on page load!
        restartGame();
    </script>
</body>
</html>
