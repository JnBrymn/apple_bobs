<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Testing</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			background: #000;
			overflow: hidden;
			font-family: Arial, sans-serif;
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
		}

		#game {
			position: relative;
			width: 100vw;
			height: 100vh;
			background: #1a1a2e;
		}

		canvas {
			display: block;
		}

		#ui {
			position: absolute;
			top: 20px;
			left: 20px;
			color: white;
			background: rgba(0, 0, 0, 0.7);
			padding: 15px;
			border-radius: 5px;
			font-size: 14px;
			z-index: 100;
		}

		#ui h2 {
			margin-bottom: 10px;
			color: #4ecdc4;
		}

		#instructions {
			position: absolute;
			bottom: 20px;
			left: 20px;
			color: white;
			background: rgba(0, 0, 0, 0.7);
			padding: 15px;
			border-radius: 5px;
			font-size: 12px;
			z-index: 100;
		}
	</style>
</head>
<body>
	<div id="game">
		<canvas id="canvas"></canvas>
		<div id="ui">
			<h2>Testing</h2>
			<p>Level: <span id="levelNum">1</span></p>
			<p id="levelName">Door Choice</p>
		</div>
		<div id="instructions">
			<p>WASD: Move | Space: Jump | E: Interact</p>
		</div>
	</div>

	<script>
		// Testing Game - Walk from door to door with puzzles
		// Puzzles: push square to button, parkour, zero gravity, etc.

		const canvas = document.getElementById('canvas');
		const ctx = canvas.getContext('2d');
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;

		let currentLevel = 0;
		let player = { x: 100, y: 400, width: 30, height: 40, vx: 0, vy: 0, onGround: false, color: '#4ecdc4' };
		let platforms = [];
		let doors = [];
		let boxes = [];
		let buttons = [];
		let gravity = 0.8;
		let levelGravity = 0.8;
		let keys = {};

		// Level definitions
		const levels = [
			{
				name: "Door Choice",
				gravity: 0.8,
				setup: () => {
					platforms = [
						{ x: 0, y: canvas.height - 50, width: canvas.width, height: 50, color: '#fff' }
					];
					doors = [
						{ x: 200, y: canvas.height - 230, width: 80, height: 180, color: '#4a4a4a', target: 1 },
						{ x: canvas.width - 280, y: canvas.height - 230, width: 80, height: 180, color: '#90ee90', target: 2 }
					];
					player.x = 100;
					player.y = canvas.height - 90;
				}
			},
			{
				name: "Push to Button",
				gravity: 0.8,
				setup: () => {
					platforms = [
						{ x: 0, y: canvas.height - 50, width: canvas.width, height: 50, color: '#fff' },
						{ x: canvas.width - 200, y: canvas.height - 200, width: 200, height: 20, color: '#3a3a4e' }
					];
					doors = [
						{ x: canvas.width - 180, y: canvas.height - 380, width: 80, height: 180, color: '#4ecdc4', target: 3 }
					];
					boxes = [
						{ x: 300, y: canvas.height - 90, width: 40, height: 40, color: '#ff6b6b', onButton: false }
					];
					buttons = [
						{ x: canvas.width - 150, y: canvas.height - 220, width: 60, height: 20, color: '#ffd700', pressed: false }
					];
					player.x = 100;
					player.y = canvas.height - 90;
				}
			},
			{
				name: "Parkour",
				gravity: 0.8,
				setup: () => {
					platforms = [
						{ x: 0, y: canvas.height - 50, width: 200, height: 50, color: '#fff' },
						{ x: 300, y: canvas.height - 150, width: 150, height: 20, color: '#3a3a4e' },
						{ x: 550, y: canvas.height - 250, width: 150, height: 20, color: '#3a3a4e' },
						{ x: 800, y: canvas.height - 350, width: 150, height: 20, color: '#3a3a4e' },
						{ x: canvas.width - 200, y: canvas.height - 450, width: 200, height: 50, color: '#fff' }
					];
					doors = [
						{ x: canvas.width - 180, y: canvas.height - 600, width: 80, height: 180, color: '#4ecdc4', target: 4 }
					];
					player.x = 50;
					player.y = canvas.height - 90;
				}
			},
			{
				name: "Zero Gravity",
				gravity: 0,
				setup: () => {
					platforms = [
						{ x: 0, y: canvas.height - 50, width: canvas.width, height: 50, color: '#fff' },
						{ x: canvas.width - 200, y: 100, width: 200, height: 50, color: '#fff' }
					];
					doors = [
						{ x: canvas.width - 180, y: 20, width: 80, height: 180, color: '#4ecdc4', target: 5 }
					];
					player.x = 100;
					player.y = canvas.height - 90;
					player.vy = 0;
				}
			},
			{
				name: "Box Stack",
				gravity: 0.8,
				setup: () => {
					platforms = [
						{ x: 0, y: canvas.height - 50, width: canvas.width, height: 50, color: '#fff' }
					];
					doors = [
						{ x: canvas.width - 180, y: canvas.height - 400, width: 80, height: 180, color: '#4ecdc4', target: 6 }
					];
					boxes = [
						{ x: 200, y: canvas.height - 90, width: 40, height: 40, color: '#ff6b6b', onButton: false },
						{ x: 300, y: canvas.height - 90, width: 40, height: 40, color: '#4ecdc4', onButton: false },
						{ x: 400, y: canvas.height - 90, width: 40, height: 40, color: '#45b7d1', onButton: false }
					];
					player.x = 100;
					player.y = canvas.height - 90;
				}
			},
			{
				name: "Final Door",
				gravity: 0.8,
				setup: () => {
					platforms = [
						{ x: 0, y: canvas.height - 50, width: canvas.width, height: 50, color: '#fff' }
					];
					doors = [
						{ x: canvas.width / 2 - 40, y: canvas.height - 230, width: 80, height: 180, color: '#ffd700', target: 0 }
					];
					player.x = 100;
					player.y = canvas.height - 90;
				}
			}
		];

		function loadLevel(levelIndex) {
			currentLevel = levelIndex;
			const level = levels[levelIndex];
			levelGravity = level.gravity;
			gravity = levelGravity;
			level.setup();
			document.getElementById('levelNum').textContent = levelIndex + 1;
			document.getElementById('levelName').textContent = level.name;
		}

		function checkCollision(rect1, rect2) {
			return rect1.x < rect2.x + rect2.width &&
				   rect1.x + rect1.width > rect2.x &&
				   rect1.y < rect2.y + rect2.height &&
				   rect1.y + rect1.height > rect2.y;
		}

		function updatePlayer() {
			// Movement
			if (keys['KeyA'] || keys['ArrowLeft']) {
				player.vx = -5;
			} else if (keys['KeyD'] || keys['ArrowRight']) {
				player.vx = 5;
			} else {
				player.vx *= 0.8;
			}

			// Jump
			if ((keys['KeyW'] || keys['ArrowUp'] || keys[' ']) && player.onGround) {
				player.vy = -15;
				player.onGround = false;
			}

			// Apply gravity
			player.vy += gravity;

			// Update position
			player.x += player.vx;
			player.y += player.vy;

			// Platform collision
			player.onGround = false;
			for (let platform of platforms) {
				if (checkCollision(player, platform)) {
					// Top collision
					if (player.vy > 0 && player.y < platform.y) {
						player.y = platform.y - player.height;
						player.vy = 0;
						player.onGround = true;
					}
					// Bottom collision
					else if (player.vy < 0 && player.y > platform.y + platform.height) {
						player.y = platform.y + platform.height;
						player.vy = 0;
					}
					// Side collisions
					if (player.vx > 0 && player.x < platform.x) {
						player.x = platform.x - player.width;
					} else if (player.vx < 0 && player.x > platform.x + platform.width) {
						player.x = platform.x + platform.width;
					}
				}
			}

			// Box collision and pushing
			for (let box of boxes) {
				if (checkCollision(player, box)) {
					// Push box
					if (player.vx > 0 && player.x < box.x) {
						box.x = player.x + player.width;
					} else if (player.vx < 0 && player.x > box.x) {
						box.x = player.x - box.width;
					}
					
					// Stand on box
					if (player.vy > 0 && player.y < box.y) {
						player.y = box.y - player.height;
						player.vy = 0;
						player.onGround = true;
					}
				}

				// Box gravity and platform collision
				box.vy = box.vy || 0;
				box.vy += gravity;
				box.y += box.vy;

				let boxOnGround = false;
				for (let platform of platforms) {
					if (checkCollision(box, platform)) {
						if (box.vy > 0 && box.y < platform.y) {
							box.y = platform.y - box.height;
							box.vy = 0;
							boxOnGround = true;
						}
				}
				}

				// Box on box
				for (let otherBox of boxes) {
					if (otherBox !== box && checkCollision(box, otherBox)) {
						if (box.vy > 0 && box.y < otherBox.y) {
							box.y = otherBox.y - box.height;
							box.vy = 0;
							boxOnGround = true;
						}
					}
				}

				if (!boxOnGround && gravity > 0) {
					box.vy += 0.2;
				}

				// Check button
				box.onButton = false;
				for (let button of buttons) {
					if (checkCollision(box, button)) {
						box.onButton = true;
						if (!button.pressed) {
							button.pressed = true;
							button.color = '#00ff00';
							// Open door or activate something
							for (let door of doors) {
								if (door.locked) {
									door.locked = false;
								}
							}
						}
					}
				}
			}

			// Boundary check
			if (player.x < 0) player.x = 0;
			if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
			if (player.y > canvas.height) {
				// Respawn
				loadLevel(currentLevel);
			}

			// Door interaction
			for (let door of doors) {
				if (checkCollision(player, door) && (keys['KeyE'] || keys['Enter'])) {
					if (!door.locked) {
						loadLevel(door.target);
						keys['KeyE'] = false;
						keys['Enter'] = false;
					}
				}
			}
		}

		function draw() {
			// Clear
			ctx.fillStyle = '#0a0a1a';
			ctx.fillRect(0, 0, canvas.width, canvas.height);

			// Draw platforms
			for (let platform of platforms) {
				ctx.fillStyle = platform.color;
				ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
			}

			// Draw buttons
			for (let button of buttons) {
				ctx.fillStyle = button.color;
				ctx.fillRect(button.x, button.y, button.width, button.height);
				ctx.strokeStyle = '#fff';
				ctx.lineWidth = 2;
				ctx.strokeRect(button.x, button.y, button.width, button.height);
			}

			// Draw boxes
			for (let box of boxes) {
				ctx.fillStyle = box.color;
				ctx.fillRect(box.x, box.y, box.width, box.height);
				ctx.strokeStyle = '#fff';
				ctx.lineWidth = 2;
				ctx.strokeRect(box.x, box.y, box.width, box.height);
			}

			// Draw doors
			for (let door of doors) {
				ctx.fillStyle = door.locked ? '#666' : door.color;
				ctx.fillRect(door.x, door.y, door.width, door.height);
				ctx.strokeStyle = door.locked ? '#ff0000' : '#fff';
				ctx.lineWidth = 3;
				ctx.strokeRect(door.x, door.y, door.width, door.height);
				
				// Door handle
				ctx.fillStyle = '#ccc';
				if (door.color === '#4a4a4a' || door.color === '#90ee90') {
					ctx.fillRect(door.x + door.width - 15, door.y + door.height / 2, 10, 3);
				} else {
					ctx.fillRect(door.x + 5, door.y + door.height / 2, 10, 3);
				}
			}

			// Draw player
			ctx.fillStyle = player.color;
			ctx.fillRect(player.x, player.y, player.width, player.height);
			ctx.strokeStyle = '#fff';
			ctx.lineWidth = 2;
			ctx.strokeRect(player.x, player.y, player.width, player.height);

			// Draw interaction hint
			for (let door of doors) {
				if (checkCollision(player, door) && !door.locked) {
					ctx.fillStyle = '#fff';
					ctx.font = '20px Arial';
					ctx.fillText('Press E', door.x, door.y - 10);
				}
			}
		}

		function gameLoop() {
			updatePlayer();
			draw();
			requestAnimationFrame(gameLoop);
		}

		// Input
		document.addEventListener('keydown', (e) => {
			keys[e.code] = true;
		});

		document.addEventListener('keyup', (e) => {
			keys[e.code] = false;
		});

		// Resize
		window.addEventListener('resize', () => {
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;
			loadLevel(currentLevel);
		});

		// Start game
		loadLevel(0);
		gameLoop();
	</script>
</body>
</html>
